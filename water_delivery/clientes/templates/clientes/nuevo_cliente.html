{% extends 'base.html' %}

{% block title %}{% if object %}Editar Cliente{% else %}Nuevo Cliente{% endif %}{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold text-agua-dark mb-6">{% if object %}Editar Cliente{% else %}Nuevo Cliente{% endif %}</h1>
<form method="post" class="bg-white rounded-xl shadow-lg p-4 max-w-md mx-auto space-y-4">
    {% csrf_token %}
    
    <!-- Campo Nombre -->
    <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-user mr-2 text-blue-500"></i>
            Nombre *
        </label>
        {{ form.nombre }}
        {% if form.nombre.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.nombre.errors.0 }}</p>
        {% endif %}
    </div>
    
    <!-- Campo Apellido -->
    <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-user mr-2 text-blue-500"></i>
            Apellido
        </label>
        {{ form.apellido }}
        {% if form.apellido.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.apellido.errors.0 }}</p>
        {% endif %}
    </div>
    
    <!-- Campo Dirección -->
    <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-map-marker-alt mr-2 text-green-500"></i>
            Dirección *
        </label>
        {{ form.direccion }}
        {% if form.direccion.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.direccion.errors.0 }}</p>
        {% endif %}
    </div>
    
    <!-- Campo Teléfono -->
    <div>
        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-phone mr-2 text-purple-500"></i>
            Teléfono
        </label>
        {{ form.telefono }}
        {% if form.telefono.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.telefono.errors.0 }}</p>
        {% endif %}
    </div>
    
    <!-- Campo Precio del Botellón -->
    <div>
        <label for="id_precio_botellon" class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">
            <i class="fas fa-dollar-sign mr-2 text-green-500"></i>
            Precio del botellón ($) *
        </label>
        <input type="number" 
               id="id_precio_botellon" 
               name="precio_botellon" 
               value="{{ form.precio_botellon.value|default:'2.50' }}"
               step="0.5" 
               min="0" 
               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
               placeholder="2.50"
               required>
        <p class="text-xs text-gray-500 mt-1">Precio por botellón. Por defecto: $2.50</p>
        {% if form.precio_botellon.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.precio_botellon.errors.0 }}</p>
        {% endif %}
    </div>
    
    <button type="submit" class="w-full bg-gradient-to-r from-agua-blue to-agua-dark text-white py-3 px-4 rounded-lg font-medium hover:from-agua-dark hover:to-agua-blue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-agua-blue transition-all duration-200 transform hover:scale-105 shadow-lg text-base">
        <i class="fas fa-save mr-2"></i>
        Guardar Cliente
    </button>
</form>

<script>
// Script mejorado para manejar el campo de precio
document.addEventListener('DOMContentLoaded', function() {
    const precioInput = document.getElementById('id_precio_botellon');
    
    if (precioInput) {
        console.log('Campo de precio encontrado:', precioInput);
        console.log('Valor inicial:', precioInput.value);
        
        // Convertir comas a puntos en tiempo real
        precioInput.addEventListener('input', function(e) {
            let value = e.target.value;
            console.log('Valor original:', value);
            
            // Reemplazar comas por puntos
            value = value.replace(',', '.');
            console.log('Valor convertido:', value);
            
            e.target.value = value;
        });
        
        // Asegurar formato correcto antes de enviar
        document.querySelector('form').addEventListener('submit', function(e) {
            let value = precioInput.value;
            console.log('Valor antes de enviar:', value);
            
            // Reemplazar comas por puntos
            value = value.replace(',', '.');
            console.log('Valor convertido para envío:', value);
            
            precioInput.value = value;
            
            // Log adicional para debugging
            console.log('Formulario enviado con precio:', precioInput.value);
            
            // Verificar que el valor sea válido
            if (!value || isNaN(parseFloat(value))) {
                e.preventDefault();
                alert('Por favor, ingresa un precio válido.');
                return false;
            }
        });
        
        // Establecer valor por defecto si está vacío
        if (!precioInput.value || precioInput.value === '') {
            precioInput.value = '2.50';
            console.log('Valor por defecto establecido:', precioInput.value);
        }
    } else {
        console.error('Campo de precio no encontrado');
    }
});
</script>
{% endblock %}